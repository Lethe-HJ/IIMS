(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a4b9382"],{"34fe":function(t,i,e){"use strict";var o=e("6b04"),r=e.n(o);r.a},"6b04":function(t,i,e){},7364:function(t,i,e){var o=e("ddf7").f,r=Function.prototype,a=/^\s*function ([^ (]*)/,s="name";s in r||e("dad2")&&o(r,s,{configurable:!0,get:function(){try{return(""+this).match(a)[1]}catch(t){return""}}})},c7ce:function(t,i,e){"use strict";e.r(i);var o=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"container"},[e("van-cell-group",[e("van-cell",{ref:t.dateText,attrs:{"is-link":"",title:"日期",value:t.displayWorkDailyDetail.work_date},on:{click:function(i){return t.showDatePicker("dateText")}}}),e("van-cell",{ref:t.projectAliasText,attrs:{"is-link":"",title:"项目别名",value:t.displayWorkDailyDetail.project_name},on:{click:function(i){return t.showProjectAliasPicker("projectAliasText")}}}),e("van-cell",{ref:t.workItemText,attrs:{"is-link":"",title:"工作简介",value:t.displayWorkDailyDetail.work_intro},on:{click:function(i){return t.showWorkItemPicker("workItemText")}}}),e("van-cell",{ref:t.workHourText,attrs:{"is-link":"",title:"工时",value:t.displayWorkDailyDetail.work_hours},on:{click:function(i){return t.showWorkHourPicker("workHourText")}}}),e("van-cell",{ref:t.workMatterText,attrs:{title:"工作日报",value:t.displayWorkDailyDetail.work_matters},on:{click:function(i){return t.editWorkMatter("workMatterText")}}}),e("van-button",{attrs:{type:"primary",size:"large"},on:{click:t.onSubmitChange}},[t._v("提交")]),e("van-button",{attrs:{type:"primary",size:"large"},on:{click:function(i){return t.newAddWorkItem(t.displayWorkDailyDetail.project_name,t.displayWorkDailyDetail.project_id)}}},[t._v("新增工作简介")]),e("van-button",{staticClass:"return-btn",attrs:{type:"primary",size:"large"},on:{click:t.goBack}},[t._v("返回")])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showEditProject,expression:"showEditProject"}],staticClass:"edit-project"},["workMatterText"==t.datePicker?e("div",{staticClass:"edit-work-matters"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.displayWorkDailyDetail.work_matters,expression:"displayWorkDailyDetail.work_matters"}],staticClass:"daily-textarea",attrs:{rows:"20",placeholder:"请输入工作日报"},domProps:{value:t.displayWorkDailyDetail.work_matters},on:{input:function(i){i.target.composing||t.$set(t.displayWorkDailyDetail,"work_matters",i.target.value)}}})]):t._e(),e("div",{staticClass:"edit-btn"},[e("van-button",{attrs:{type:"primary"},on:{click:t.onEditSubmit}},[t._v("完成")]),e("van-button",{staticClass:"return-btn",attrs:{type:"primary"},on:{click:t.onEidtCancel}},[t._v("取消")])],1)]),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPopShow,callback:function(i){t.isPopShow=i},expression:"isPopShow"}},["projectAliasText"==t.datePicker?e("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},model:{value:t.searchByProjectAliasText,callback:function(i){t.searchByProjectAliasText=i},expression:"searchByProjectAliasText"}}):t._e(),"workItemText"==t.datePicker?e("van-search",{attrs:{placeholder:"请输入搜索关键词",shape:"round"},model:{value:t.searchByWorkItemText,callback:function(i){t.searchByWorkItemText=i},expression:"searchByWorkItemText"}}):t._e(),"dateText"==t.datePicker?e("van-datetime-picker",{attrs:{title:"选择日期",type:"date",formatter:t.formatter},on:{cancel:t.cancelPicker,confirm:t.confirmDatePicker},model:{value:t.currentDate,callback:function(i){t.currentDate=i},expression:"currentDate"}}):t._e(),"projectAliasText"==t.datePicker?e("van-picker",{attrs:{"show-toolbar":"",columns:t.displayProjectAlias,title:"选择项目别名"},on:{cancel:t.cancelPicker,confirm:t.confirmProjectAliasPicker}}):t._e(),"workItemText"==t.datePicker?e("van-picker",{attrs:{"show-toolbar":"",columns:t.displayWorkItem,title:"选择工作简介"},on:{cancel:t.cancelPicker,confirm:t.confirmWokrItemPicker}}):t._e(),"workHourText"==t.datePicker?e("van-picker",{attrs:{"show-toolbar":"",columns:t.displayWorkHour,title:"选择工时","default-index":7},on:{cancel:t.cancelPicker,confirm:t.confirmWorkHourPicker}}):t._e()],1),e("van-popup",{model:{value:t.isShowPrompted,callback:function(i){t.isShowPrompted=i},expression:"isShowPrompted"}},[e("div",{staticClass:"prompted-box"},[e("span",[t._v("当前项目别名下没有工作简介，是否新增工作简介")]),e("van-button",{attrs:{type:"primary",size:"large"},on:{click:function(i){return t.addWorkItemFromPrompted(t.displayWorkDailyDetail.project_name,t.displayWorkDailyDetail.project_id)}}},[t._v("是")]),e("van-button",{staticClass:"return-btn",attrs:{type:"primary",size:"large"},on:{click:t.cancleAdd}},[t._v("否")])],1)])],1)},r=[],a=(e("7364"),e("e12b"),{name:"EditWorkDaily",components:{},data:function(){return{dateText:"dateText",projectAliasText:"projectAliasText",workHourText:"workHourText",workItemText:"workItemText",workMatterText:"workMatterText",currentDate:new Date,displayProjectAlias:[],displayWorkItem:[],displayWorkHour:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],showEditProject:!1,isPopShow:!1,isShowPrompted:!1,datePicker:"",searchByProjectAliasText:"",projectAliasId:[],workItemId:[],searchProjectAlias:[],searchByWorkItemText:"",searchWorkItem:[],initWorkMatters:""}},computed:{displayWorkDailyDetail:function(){return this.$store.state.displayWorkDailyDetail},judgeAdd:function(){return this.$store.state.judgeAdd}},mounted:function(){var t=this,i=this.$route.query.workDailyId;if(-1!=i){var e={daily_id:i};this.$api.get("/iims/dailies/edit/data?",e).then(function(i){if(1===i.status){console.log("工作日报详细数据",i);var e=i.data;e.work_date=e.work_date.substring(0,10),t.$store.commit("storeDisplayWorkDailyDetail",e)}}).catch(function(t){console.log(t)})}else{var o=this.confirmDate(new Date),r={work_matters:"",work_hours:8,project_id:"",workintro_id:"",work_date:o};this.$store.commit("storeDisplayWorkDailyDetail",r)}this.$api.get("/iims/common/projects/data?limit=20").then(function(i){if(1===i.status){console.log("项目别名数据",i);var e=[];i.data.projects.some(function(t,i){e.push(t)});for(var o=[],r=[],a=0;a<e.length;a++)o.push(e[a].name),r.push(e[a].id);t.displayProjectAlias=o,t.projectAliasId=r}}).catch(function(t){console.log(t)})},methods:{onChange:function(t){console.log("123124",t.format(t))},goBack:function(){this.$router.go(-1)},showDatePicker:function(t){this.isPopShow=!0,this.showEditProject=!1,this.datePicker=t},cancelPicker:function(){this.isPopShow=!1,this.datePicker=""},confirmDate:function(t){var i=t,e=i.getMonth()+1,o=i.getDate();e>=1&&e<=9&&(e="0"+e),o>=0&&o<=9&&(o="0"+o);var r=i.getFullYear()+"-"+e+"-"+o;return r},formatter:function(t,i){return"year"===t?"".concat(i,"年"):"month"===t?"".concat(i,"月"):"day"===t?"".concat(i,"日"):i},confirmDatePicker:function(t){var i=this.confirmDate(t);this.displayWorkDailyDetail.work_date=i,this.hiddenPicker()},hiddenPicker:function(){this.isPopShow=!1,this.datePicker=""},confirmProjectAliasPicker:function(t,i){var e=this;this.displayWorkDailyDetail.project_name=t,this.displayWorkDailyDetail.project_id=this.projectAliasId[i],console.log("搜索的项目别名",this.searchProjectAlias),this.searchProjectAlias.some(function(i,o){if(i.name===t)return e.displayWorkDailyDetail.project_id=i.id,!0}),console.log("获取选中的项目别名id",this.displayWorkDailyDetail.project_id),this.hiddenPicker()},confirmWokrItemPicker:function(t,i){var e=this;this.displayWorkDailyDetail.work_intro=t,this.displayWorkDailyDetail.workintro_id=this.workItemId[i],this.searchWorkItem.some(function(i,o){if(i.name===t)return e.displayWorkDailyDetail.workintro_id=i.id,!0}),console.log(this.displayWorkDailyDetail.workintro_id),this.hiddenPicker()},confirmWorkHourPicker:function(t){this.displayWorkDailyDetail.work_hours=t,this.hiddenPicker()},showPicker:function(t){this.initWorkMatters&&this.showEditProject&&(this.displayWorkDailyDetail.work_matters=this.initWorkMatters),this.isPopShow=!0,this.showEditProject=!1,this.datePicker=t},showProjectAliasPicker:function(t){this.showPicker(t)},showWorkItemPicker:function(t){var i=this;console.log("this.displayWorkDailyDetail.project_id",this.displayWorkDailyDetail.project_id);var e={project_id:this.displayWorkDailyDetail.project_id};this.$api.get("/iims/common/intros/data?",e).then(function(o){if(console.log(e),1===o.status){i.displayWorkDailyDetail.project_id?i.displayWorkDailyDetail.project_id&&o.data.intros.length>0?i.showPicker(t):i.isShowPrompted=!0:i.$toast("请先选择项目别名"),console.log(o);var r=[],a=[];o.data.intros.some(function(t,i){r.push(t.name),a.push(t.id)}),i.displayWorkItem=r,i.workItemId=a}}).catch(function(t){console.log(t)})},onSubmitChange:function(){var t=this;if(this.judgeAdd)if(this.displayWorkDailyDetail.workintro_id)if(this.displayWorkDailyDetail.work_matters){i={work_matters:this.displayWorkDailyDetail.work_matters,work_hours:this.displayWorkDailyDetail.work_hours,project_id:this.displayWorkDailyDetail.project_id,workintro_id:this.displayWorkDailyDetail.workintro_id,work_date:this.displayWorkDailyDetail.work_date};this.$api.post("/iims/dailies/add?",i).then(function(i){console.log("12312",i),1===i.status?(t.$Toast("新增成功"),t.$router.push({name:"work_daily"})):t.$toast(i.message)}).catch(function(t){console.log(t)})}else this.$myToast("项目简介不能为空","warning","1500");else this.$myToast("工作日报不能为空","warning","1500");else if(this.displayWorkDailyDetail.workintro_id)if(this.displayWorkDailyDetail.work_matters){var i={daily_id:this.displayWorkDailyDetail.daily_id,project_id:this.displayWorkDailyDetail.project_id,workintro_id:this.displayWorkDailyDetail.workintro_id,work_date:this.displayWorkDailyDetail.work_date,work_hours:this.displayWorkDailyDetail.work_hours,work_matters:this.displayWorkDailyDetail.work_matters};console.log("修改工作日报参数",i),this.$api.put("/iims/dailies/edit?",i).then(function(i){1===i.status&&(console.log("工作日报提交修改接口",i),"工作日报数据修改成功"===i.message&&(t.$router.push({name:"work_daily"}),t.$myToast("修改成功","success","1500")))}).catch(function(i){console.log(i),t.$myToast("修改失败","error","1500")})}else this.$myToast("项目简介不能为空","warning","1500");else this.$myToast("工作日报不能为空","warning","1500")},newAddWorkItem:function(t,i){i?(this.$store.commit("changeJudgeAdd",!0),this.$router.push({name:"EditWorkItem",query:{projectName:t,projectId:i,enterItemFormDaily:!0}})):this.$toast("请先选择一个项目别名")},addWorkItemFromPrompted:function(t,i){this.newAddWorkItem(t,i)},cancleAdd:function(){this.isShowPrompted=!1},showWorkHourPicker:function(t){this.showPicker(t)},editWorkMatter:function(t){this.isPopShow=!1,this.showEditProject=!0,this.datePicker=t,this.initWorkMatters=this.displayWorkDailyDetail.work_matters},onEidtCancel:function(){this.isPopShow=!1,this.showEditProject=!1,this.showEdit="",this.displayWorkDailyDetail.work_matters=this.initWorkMatters},onEditSubmit:function(){this.isPopShow=!1,this.showEditProject=!1,this.showEdit=""},getSearchProjectAlias:function(t){var i=this,e={query:t};this.$api.get("/iims/common/projects/query?",e).then(function(t){if(1===t.status){var e=[];t.data.projects.some(function(t,i){e.push(t)}),i.searchProjectAlias=e;for(var o=[],r=0;r<t.data.projects.length;r++)o.push(t.data.projects[r].name);i.displayProjectAlias=o}}).catch(function(t){console.log(t)})},getSearchWorkItem:function(t){var i=this,e={query:t,project_id:this.displayWorkDailyDetail.project_id};this.$api.get("/iims/common/intros/query?",e).then(function(t){if(1===t.status){console.log("查询项目简介",t);var e=[],o=[];t.data.intros.some(function(t,i){e.push(t.id),o.push(t.name)}),i.workItemId=e,i.displayWorkItem=o}}).catch(function(t){console.log(t)})}},watch:{searchByProjectAliasText:function(t){this.getSearchProjectAlias(t)},searchByWorkItemText:function(t){this.getSearchWorkItem(t)}}}),s=a,n=(e("34fe"),e("6691")),c=Object(n["a"])(s,o,r,!1,null,"f9ed7cf6",null);i["default"]=c.exports}}]);
//# sourceMappingURL=chunk-7a4b9382.8659cbe8.js.map